--- What is the average order value per user? ---
SELECT 
    CONCAT('$', FORMAT(AVG(o.total_price), 2)) AS 'Average Order Value',
    CONCAT(u.first_name, ' ', u.last_name) AS 'Customer Name',
    COUNT(o.order_id) AS 'Total Orders',
    MAX(o.created_at) AS 'Last Order Date'
FROM orders o
JOIN users u ON o.user_id = u.user_id
WHERE o.order_status IN ('shipped', 'delivered')  -- Filter by completed orders
GROUP BY u.user_id, u.first_name, u.last_name
HAVING AVG(o.total_price) > 100  -- Only show customers with an average order > $100
ORDER BY AVG(o.total_price) DESC;




-----Week 12 Contribution #8----
            ---View---

CREATE VIEW view_average_order_value AS
SELECT 
    CONCAT('$', FORMAT(AVG(o.total_price), 2)) AS 'Average Order Value',
    CONCAT(u.first_name, ' ', u.last_name) AS 'Customer Name',
    COUNT(o.order_id) AS 'Total Orders',
    MAX(o.created_at) AS 'Last Order Date'
FROM orders o
JOIN users u ON o.user_id = u.user_id
WHERE o.order_status IN ('shipped', 'delivered')  -- Filter by completed orders
GROUP BY u.user_id, u.first_name, u.last_name
HAVING AVG(o.total_price) > 100  -- Only show customers with an average order > $100
ORDER BY AVG(o.total_price) DESC;

SELECT
    Average Order Value
,   Customer Name
,   Total Orders
,   Last Order Date
FROM view_average_order_value
